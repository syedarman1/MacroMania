{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MacroMania</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <!-- Linking the updated CSS -->
    <link href="{% static 'style.css' %}" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <div class="container text-center">
      <img src="{% static 'images/logo.png' %}" class="img-responsive logo" alt="MacroMania Logo" />

      <!-- Search bar and button -->
      <form method="POST">
        {% csrf_token %}
        <div class="input-group">
          <input type="text" name="query" class="form-control" placeholder="Search for calories in your food..." required />
          <button class="btn btn-primary" type="submit">Find calories</button>
        </div>
      </form>

      <!-- Unit input and conversions -->
      <label for="unit-select">Choose unit of measure:</label>
      <input type="number" id="unit-input" value="100" onchange="updateUnits()" />
      <select id="unit-select" onchange="updateUnits()">
        <option value="1">grams</option>
        <option value="28.35">oz</option>
        <option value="453.6">lbs</option>
      </select>

      <!-- Calories and Nutritional Values -->
      {% if api %}
      <h1 id="calories">{{ api.foods.0.food_name | capfirst }} has a total of <strong>{{ api.foods.0.nf_calories }}</strong> Calories</h1>
      <div class="nutrition-list">
        <div class="nutrition-card">
          <p>Carbohydrates</p>
          <p id="carbs">{{ api.foods.0.nf_total_carbohydrate }} g</p>
        </div>
        <div class="nutrition-card">
          <p>Total Fat</p>
          <p id="fats">{{ api.foods.0.nf_total_fat }} g</p>
        </div>
        <div class="nutrition-card">
          <p>Protein</p>
          <p id="protein">{{ api.foods.0.nf_protein }} g</p>
        </div>
        <div class="nutrition-card">
          <p>Sodium</p>
          <p id="sodium">{{ api.foods.0.nf_sodium }} mg</p>
        </div>
        <div class="nutrition-card">
          <p>Potassium</p>
          <p id="potassium">{{ api.foods.0.nf_potassium }} mg</p>
        </div>
        <div class="nutrition-card">
          <p>Sugar</p>
          <p id="sugar">{{ api.foods.0.nf_sugars }} g</p>
        </div>
      </div>
      {% endif %}

      <!-- Toggle Dark Mode Button -->
      <button class="btn btn-secondary" onclick="toggleDarkMode()">Toggle Dark Mode</button>
    </div>

    <script>
      function updateUnits() {
        const unitInput = parseFloat(document.getElementById("unit-input").value);
        const unitSelect = parseFloat(document.getElementById("unit-select").value);
        const conversionFactor = (unitInput * unitSelect) / 100;

        // Update the calorie and nutrient values dynamically
        document.getElementById("calories").innerHTML =
          `{{ api.foods.0.food_name | capfirst }} has a total of <strong>${(calories * conversionFactor).toFixed(2)}</strong> Calories`;

        document.getElementById("carbs").innerText = `${(carbs * conversionFactor).toFixed(2)} g`;
        document.getElementById("fats").innerText = `${(fats * conversionFactor).toFixed(2)} g`;
        document.getElementById("protein").innerText = `${(protein * conversionFactor).toFixed(2)} g`;
        document.getElementById("sodium").innerText = `${(sodium * conversionFactor).toFixed(2)} mg`;
        document.getElementById("potassium").innerText = `${(potassium * conversionFactor).toFixed(2)} mg`;
        document.getElementById("sugar").innerText = `${(sugar * conversionFactor).toFixed(2)} g`;
      }

      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
      }
    </script>
  </body>
</html>
